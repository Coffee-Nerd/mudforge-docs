# Examples

Working plugin examples to learn from.

## Simple Echo Plugin

The simplest possible plugin:

```lua
settings = {
  name = "Echo Plugin",
  version = "1.0.0",
}

function initialize()
  echo("Hello from Echo Plugin!")

  addAlias("^/greet (.+)$", function(match, name)
    send("say Hello, " .. name .. "!")
  end, true)
end
```

## Canvas Widget

Drawing shapes on a canvas:

```lua
settings = {
  name = "Canvas Demo",
  version = "1.0.0",
}

local widget = nil

function initialize()
  widget = createWidget({
    type = "canvas",
    title = "Shapes",
    x = 100,
    y = 100,
    width = 300,
    height = 200
  })

  -- Draw on the canvas (automatically active after createWidget)
  clear("#1a1a2e")

  -- Draw various shapes
  drawRect(20, 20, 80, 60, "#e94560")
  drawCircle(180, 50, 40, "#0f3460")
  drawLine(20, 150, 280, 150, "#16c79a", 3)
  drawText("Hello World!", 100, 180, "#ffffff", "16px Arial")
end

function shutdown()
  if widget then
    destroyWidget(widget)
  end
end
```

## Trigger with Capture Groups

Capturing data from MUD output:

```lua
settings = {
  name = "Combat Logger",
  version = "1.0.0",
}

local kills = 0

function initialize()
  -- Trigger with regex capture groups
  addTrigger("You have slain (.+)!", function(match, target)
    kills = kills + 1
    echo("[Combat] Killed: " .. target .. " (Total: " .. kills .. ")")
  end, true)

  -- Alias to check stats
  addAlias("^/kills$", function()
    echo("Total kills this session: " .. kills)
  end, true)
end
```

## Timer Example

Periodic actions:

```lua
settings = {
  name = "Auto-Heal",
  version = "1.0.0",
}

local healTimer = nil
local isHurt = false

function initialize()
  -- Check health periodically
  healTimer = addTimer(5000, function()
    if isHurt then
      send("cast heal self")
    end
  end, true)  -- true = repeating

  -- Track when we get hurt
  addTrigger("You are wounded!", function()
    isHurt = true
    echo("[Auto-Heal] Activating healing...")
  end, false)

  -- Track when we're healed
  addTrigger("You are fully healed.", function()
    isHurt = false
    echo("[Auto-Heal] Healing complete.")
  end, false)
end

function shutdown()
  if healTimer then
    removeTimer(healTimer)
  end
end
```

## Using GMCP Data

Accessing protocol data:

```lua
settings = {
  name = "Room Tracker",
  version = "1.0.0",
}

function initialize()
  -- Get current room
  local room = getCurrentRoom()
  if room then
    echo("Current room: " .. (room.name or "Unknown"))
  end

  -- Subscribe to room changes
  onGMCPUpdate("Room.Info", function(data)
    echo("Moved to: " .. (data.name or "Unknown room"))
    echo("Exits: " .. table.concat(data.exits or {}, ", "))
  end)
end
```

## Multi-Session Communication

Sending commands between sessions:

```lua
settings = {
  name = "Session Coordinator",
  version = "1.0.0",
}

function initialize()
  -- Command to send to all sessions
  addAlias("^/all (.+)$", function(match, cmd)
    sendToAll(cmd)
    echo("Sent to all sessions: " .. cmd)
  end, true)

  -- Command to send to specific session
  addAlias("^/to (%w+) (.+)$", function(match, session, cmd)
    sendToSession(session, cmd)
    echo("Sent to " .. session .. ": " .. cmd)
  end, true)

  -- Listen for global events
  onGlobal("party:heal", function(data)
    if data.target == getSession().name then
      send("cast heal " .. data.caster)
    end
  end)
end
```
